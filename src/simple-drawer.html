<link rel="import" href="../polymer/polymer.html">

<dom-module id="simple-drawer">
  <template>
    <style>
      :host, *, *::before, *::after {
        box-sizing: border-box;
      }

      :host {
        position: fixed;
        display: block;
        top: 0;
        bottom: 0;
        background: white;
        outline: none;
        z-index: 2147483647;
        box-shadow: 0 6px 10px 0 rgba(0, 0, 0, 0.14),
                    0 1px 18px 0 rgba(0, 0, 0, 0.12),
                    0 3px 5px -1px rgba(0, 0, 0, 0.4);
        -moz-osx-font-smoothing: grayscale;
         -webkit-font-smoothing: antialiased;
                 font-smoothing: antialiased;
        transition: transform 125ms cubic-bezier(0.4, 0.0, 1, 1);
      }

      :host(:not([active])) {
        display: none;
      }

      :host([visible]) {
        transform: translateZ(0) translateX(0) !important;
        transition: transform 250ms cubic-bezier(0.0, 0.0, 0.2, 1);
      }

      :host([position="left"]) {
        left: 0;
        transform: translateZ(0) translateX(-100%);
      }

      :host([position="right"]) {
        right: 0;
        transform: translateZ(0) translateX(100%);
      }

      :host([disabled]) {
        display: block;
        position: relative;
        box-shadow: none;
        transform: none !important;
      }
    </style>

    <content></content>

  </template>

  <script>
    class SimpleDrawer {
      beforeRegister() {
        this.is = 'simple-drawer',

        this.properties = {

          /**
           *  Changes to active state trigger opening/closing of drawer
           *  @type {Boolean}
           */
          active: {
            type: Boolean,
            reflectToAttribute: true,
            readonly: true
          },

          /**
           *  Set by animations, to handle CSS display changes
           *  @type {Boolean}
           */
          visible: {
            type: Boolean,
            reflectToAttribute: true,
            readonly: true
          },

          /**
           * Stop drawer exiting on escape
           * @type {Boolean}
           */
          noEscape: Boolean,

          /**
           * Stop drawer exiting on outside click
           * @type {Boolean}
           */
          noBlur: Boolean,

          /**
           *  Whether to position the drawer on the left or right of the viewport
           *  @type {String} left|right
           */
          position: {
            type: String,
            value: 'left',
            reflectToAttribute: true
          },

          /**
           * Disable the panel, so can be used in responsive situations
           * @type {Boolean}
           */
          disabled: {
            type: Boolean,
            reflectToAttribute: true,
            notify: true
          },

          tabindex: {
            type: Number,
            reflectToAttribute: true,
            readonly: true,
            value: 0
          }

        };

        this.observers = [
          '_goVisibleOnActive(active)',
          '_closeOnEscape(active)',
          '_focusOnActive(active)'
        ];

        this.listeners = {
          blur: '_closeOnBlur',
          transitionend: '_goInactiveOnClose'
        }
      }

      open() {
        this.active = true;
      }

      close() {
        this.visible = false;
      }

      toggle() {
        if (this.active) {
          this.close();
        } else {
          this.open();
        }
      }

      _goVisibleOnActive(active) {
        if (active) {
          Polymer.RenderStatus
            .afterNextRender(this, () => this.visible = true);
        }
      }

      _goInactiveOnClose(e) {
        if (!this.visible) {
          this.active = false;
        }
      }

      _focusOnActive(active) {
        if (active) {
          this.focus();
        }
      }

      _closeOnBlur(e) {
        if (!this.noBlur) {
          this.close();
        }
      }

      _closeOnEscape(active) {
        let closeIfEscape = (e) => {
          if (e.keyCode === 27 && !this.noEscape) {
            this.active = false;
          }
        };

        if (active) {
          document.addEventListener('keydown', closeIfEscape);
        } else {
          document.removeEventListener('keydown', closeIfEscape);
        }
      }

      _lockBodyWhenOpen(active) {
        let bodyStyle = document.body.style;

        if (active) {
          bodyStyle.overflow = 'hidden';
        } else {
          bodyStyle.overflow = '';
        }
      }
    };
    Polymer(SimpleDrawer)
  </script>
</dom-module>
